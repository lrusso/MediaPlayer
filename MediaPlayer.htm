<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Media Player</title>
    <link
      rel="icon"
      sizes="16x16"
      type="image/png"
      href="data:image/png;base64,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"
    >
    <meta name="theme-color" content="#000">
    <meta
      name="keywords"
      content="media, player, video, audio, music, captions, subtitles, mp3, mp4, srt"
    >
    <meta name="description" content="Media Player.">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0"
    >
    <style>
      *{outline:0!important;user-select:none;-moz-user-select:none;-webkit-user-select:none}html,body{background-color:#000;padding:0;margin:0;font-family:Arial}#fileloader-container{display:none}#media-container{position:fixed;left:0;right:0;top:0;bottom:0;width:100%;height:100%;display:none}video{width:100%;height:100%}input[type=file]{display:none}#email{position:fixed;right:0;bottom:0;padding-right:15px;line-height:3.2;font-family:Arial;font-size:16px;color:#fff;user-select:none;-webkit-user-select:none}#email a{text-decoration:none;color:#fff;background-color:transparent;border:0;outline:0}#email a:focus{text-decoration:none;outline:1px solid #fff!important}#file-selector{position:fixed;left:0;bottom:0;right:0;top:0;width:20vw;height:20vw;margin:auto auto;cursor:pointer;background-color:transparent;outline:0;border:0}#file-selector:focus{outline:1px solid #fff!important}#file-selector:hover{filter:brightness(110%)}#subtitles-display{position:fixed;left:0;bottom:15px;right:0;text-align:center;color:#ff0!important;font-size:4vw;text-shadow:1px 1px 2px #000,0 0 5px #000;background-color:transparent!important;cursor:default}#controls-background{position:fixed;left:0;right:0;bottom:0;height:75px;background:linear-gradient(to bottom,transparent,#000);display:none}#controls-container{position:fixed;bottom:0;left:0;right:0;padding-left:18px;padding-right:18px;padding-top:8px;padding-bottom:16px;display:flex;align-items:center;gap:15px;opacity:0;visibility:hidden}#controls-container.visible{opacity:1;visibility:visible}#controls-container button{background:0 0;border:0;padding:0;display:flex;align-items:center;justify-content:center}#controls-container button svg{width:24px;height:24px;fill:#fff}#progress-bar{flex-grow:1;cursor:pointer;height:8px}progress{-webkit-appearance:none;appearance:none}progress::-webkit-progress-bar{background-color:rgba(255,255,255,.3);border-radius:4px}progress::-webkit-progress-value{background-color:#fff;border-radius:4px;transition:width .1s linear}progress::-moz-progress-bar{background-color:#fff;border-radius:4px}#play-pause-btn{position:fixed;left:12px;bottom:39px;cursor:pointer}#time-display{position:fixed;left:48px;bottom:42px;color:#fff;font-size:14px;text-align:center;cursor:default;user-select:none;-webkit-user-select:none}#volume-controls{position:fixed;right:48px;bottom:39px;display:flex;align-items:center}#volume-slider-container{position:absolute;bottom:35px;left:50%;transform:translateX(-50%);background-color:rgba(0,0,0,.6);padding:12px 8px;border-radius:8px;opacity:0;visibility:hidden;transition:opacity .2s ease,visibility .2s ease}#volume-slider-container.visible{opacity:1;visibility:visible}#volume-slider-track{position:relative;width:6px;height:80px;background-color:rgba(255,255,255,.3);border-radius:3px;cursor:pointer}#volume-slider-level{position:absolute;bottom:0;width:100%;background-color:#fff;border-radius:3px}#fullscreen-btn{position:fixed;right:12px;bottom:39px;cursor:pointer}#repeat-media-btn,#prev-media-btn,#next-media-btn{position:fixed;bottom:39px;background:0 0;border:0;cursor:pointer;padding:0;align-items:center;justify-content:center}#repeat-media-btn{right:155px;opacity:.5}#prev-media-btn{right:120px}#next-media-btn{right:85px}#volume-btn{cursor:pointer}#audio-info-container{position:absolute;top:0;bottom:0;left:0;right:0;display:flex;padding-left:10px;padding-right:10px;flex-direction:column;justify-content:center;align-items:center;text-align:center;color:#fff;display:none}#album-cover{display:none;width:300px;height:300px;object-fit:contain;border-radius:8px;margin-bottom:20px}#song-title{width:100%;font-size:2.5em;font-weight:700;margin:10px 0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#artist-name,#album-name{font-size:1.5em;color:#b3b3b3}.pleasewait{position:fixed;width:64px;height:64px;left:0;right:0;top:0;bottom:0;margin:auto auto;border:0}.lds-spinner{color:#fff;display:inline-block;position:relative;width:64px;height:64px}.lds-spinner div{transform-origin:32px 32px;animation:lds-spinner 1.2s linear infinite}.lds-spinner div:after{content:" ";display:block;position:fixed;top:3px;left:29px;width:5px;height:14px;border-radius:20%;background:#fff}.lds-spinner div:nth-child(1){transform:rotate(0deg);animation-delay:-1.1s}.lds-spinner div:nth-child(2){transform:rotate(30deg);animation-delay:-1s}.lds-spinner div:nth-child(3){transform:rotate(60deg);animation-delay:-.9s}.lds-spinner div:nth-child(4){transform:rotate(90deg);animation-delay:-.8s}.lds-spinner div:nth-child(5){transform:rotate(120deg);animation-delay:-.7s}.lds-spinner div:nth-child(6){transform:rotate(150deg);animation-delay:-.6s}.lds-spinner div:nth-child(7){transform:rotate(180deg);animation-delay:-.5s}.lds-spinner div:nth-child(8){transform:rotate(210deg);animation-delay:-.4s}.lds-spinner div:nth-child(9){transform:rotate(240deg);animation-delay:-.3s}.lds-spinner div:nth-child(10){transform:rotate(270deg);animation-delay:-.2s}.lds-spinner div:nth-child(11){transform:rotate(300deg);animation-delay:-.1s}.lds-spinner div:nth-child(12){transform:rotate(330deg);animation-delay:0s}@keyframes lds-spinner{0%{opacity:1}to{opacity:0}}@media screen and (min-height:0px) and (max-height:600px){#album-cover{width:150px;height:150px;margin-bottom:0}#song-title{font-size:1.5em;margin-top:10px}#artist-name,#album-name{font-size:.9em}}
    </style>
  </head>
  <body>
    <div class="pleasewait">
      <div class="lds-spinner">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
    <div id="fileloader-container">
      <div id="email"><a href="mailto:info@lrusso.com">info@lrusso.com</a></div>
      <button id="file-selector" tabindex="1">
        <svg width="100%" height="100%" viewBox="0 0 502 502">
          <circle fill="#FFF" cx="250" cy="250" r="200" />
          <path
            fill="#b9180b"
            d="M251,1C112.929,1,1,112.929,1,251s111.929,250,250,250s250-111.929,250-250S389.071,1,251,1z M164.75,366  V136l230,115L164.75,366z"
          />
        </svg>
      </button>
      <input type="file" id="mediafile-input" multiple>
    </div>
    <div id="media-container">
      <video id="mediaPlayer" playsinline></video>
      <div id="audio-info-container">
        <img
          id="album-cover"
          alt="Album Cover"
          src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5QgIBRYuuRw5TAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAADElEQVQI12P4//8/AAX+Av7czFnnAAAAAElFTkSuQmCC"
        >
        <span id="song-title"></span>
        <span id="artist-name"></span>
        <span id="album-name"></span>
      </div>
      <div id="subtitles-display"></div>
      <div id="controls-background"></div>
      <div id="controls-container">
        <button id="repeat-media-btn">
          <svg width="24" height="24" viewBox="0 0 512 512">
            <path
              transform="translate(28,20) scale(0.9,0.9)"
              d="M127.8,128.2h256.4v77.1l102.2-102.2L384.2,0v77.1H76.7v153.3h51.1V128.2z M384.2,384.6H127.8v-77.1 L25.6,409.8L127.8,512v-77.1h307.5V282.4h-51.1C384.2,282.4,384.2,384.6,384.2,384.6z M282,333.5V179.3h-26l-51.1,26v26h38.5v102.2 C243.4,333.5,282,333.5,282,333.5z"
            />
          </svg>
        </button>
        <button id="prev-media-btn">
          <svg width="24" height="24" viewBox="0 0 24 24">
            <path
              transform="translate(27.5,-3.5),scale(-1.3, 1.3)"
              d="M6,17.99V6.01L11,12L6,17.99M13,6V18L18.5,12L13,6Z"
            />
          </svg>
        </button>
        <button id="next-media-btn">
          <svg width="24" height="24" viewBox="0 0 24 24">
            <path
              transform="translate(-3.25, -3.5),scale(1.3,1.3)"
              d="M6,17.99V6.01L11,12L6,17.99M13,6V18L18.5,12L13,6Z"
            />
          </svg>
        </button>
        <button id="play-pause-btn">
          <svg width="24" height="24" viewBox="0 0 24 24">
            <path d="M8,5.14V19.14L19,12.14L8,5.14Z" />
          </svg>
        </button>
        <progress id="progress-bar" value="0"></progress>
        <span id="time-display"></span>
        <div id="volume-controls">
          <button id="volume-btn"></button>
          <div id="volume-slider-container">
            <div id="volume-slider-track">
              <div id="volume-slider-level"></div>
            </div>
          </div>
        </div>
        <button id="fullscreen-btn"></button>
      </div>
    </div>
    <script>
      function _btoa(t) {
        var h = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
        var r = ""
        var a = 0
        while (a < t.length) {
          var e = t.charCodeAt(a)
          a = a + 1
          var c = a < t.length ? t.charCodeAt(a) : 0
          if (a < t.length) {
            a = a + 1
          }
          var n = a < t.length ? t.charCodeAt(a) : 0
          if (a < t.length) {
            a = a + 1
          }
          var A = ((3 & e) << 4) | (c >> 4)
          var o = ((15 & c) << 2) | (n >> 6)
          var g = 63 & n
          r = r + h.charAt(e >> 2) + h.charAt(A)
          r = r + (a - 1 < t.length ? h.charAt(o) : "=")
          r = r + (a < t.length ? h.charAt(g) : "=")
        }
        return r
      }

      function parseID3Tags(file, callback) {
        var reader = new FileReader()
        reader.addEventListener("load", function (e) {
          var buffer = e.target.result
          var view = new DataView(buffer)
          var tags = { title: "", artist: "", album: "", cover: null }

          if (
            view.byteLength < 10 ||
            String.fromCharCode(
              view.getUint8(0),
              view.getUint8(1),
              view.getUint8(2)
            ) !== "ID3"
          ) {
            callback(tags)
            return
          }

          var version = view.getUint8(3)
          var tagSize =
            ((view.getUint8(6) & 0x7f) << 21) |
            ((view.getUint8(7) & 0x7f) << 14) |
            ((view.getUint8(8) & 0x7f) << 7) |
            (view.getUint8(9) & 0x7f)

          var pos = 10
          var end = 10 + tagSize

          while (pos < end && pos + 10 <= view.byteLength) {
            var id =
              String.fromCharCode(view.getUint8(pos)) +
              String.fromCharCode(view.getUint8(pos + 1)) +
              String.fromCharCode(view.getUint8(pos + 2)) +
              String.fromCharCode(view.getUint8(pos + 3))

            if (id === "\0\0\0\0") {
              break
            }

            var size =
              version === 4
                ? ((view.getUint8(pos + 4) & 0x7f) << 21) |
                  ((view.getUint8(pos + 5) & 0x7f) << 14) |
                  ((view.getUint8(pos + 6) & 0x7f) << 7) |
                  (view.getUint8(pos + 7) & 0x7f)
                : (view.getUint8(pos + 4) << 24) |
                  (view.getUint8(pos + 5) << 16) |
                  (view.getUint8(pos + 6) << 8) |
                  view.getUint8(pos + 7)

            if (size > 0 && pos + 10 + size <= view.byteLength) {
              var data = new Uint8Array(buffer, pos + 10, size)

              if (id === "TIT2" || id === "TPE1" || id === "TALB") {
                var text = ""
                var enc = data[0]
                var start = 1

                if (enc === 1 && data[1] === 0xff && data[2] === 0xfe) {
                  start = 3
                }
                if (enc === 1 && data[1] === 0xfe && data[2] === 0xff) {
                  start = 3
                }

                if (enc === 0) {
                  for (var i = start; i < data.length && data[i] !== 0; i++) {
                    text = text + String.fromCharCode(data[i])
                  }
                } else if (enc === 3) {
                  var encoded = ""
                  for (var i = start; i < data.length && data[i] !== 0; i++) {
                    var hex = data[i].toString(16)
                    encoded = encoded + "%" + (hex.length < 2 ? "0" + hex : hex)
                  }
                  try {
                    text = decodeURIComponent(encoded)
                  } catch (err) {
                    for (var i = start; i < data.length && data[i] !== 0; i++) {
                      text = text + String.fromCharCode(data[i])
                    }
                  }
                } else if (enc === 1 || enc === 2) {
                  for (var i = start; i < data.length - 1; i = i + 2) {
                    if (data[i] === 0 && data[i + 1] === 0) {
                      break
                    }
                    var code =
                      enc === 1
                        ? data[i] | (data[i + 1] << 8)
                        : (data[i] << 8) | data[i + 1]
                    text = text + String.fromCharCode(code)
                  }
                }

                if (id === "TIT2") {
                  tags.title = text.replace(/^\s+|\s+$/g, "")
                }
                if (id === "TPE1") {
                  tags.artist = text.replace(/^\s+|\s+$/g, "")
                }
                if (id === "TALB") {
                  tags.album = text.replace(/^\s+|\s+$/g, "")
                }
              }

              if (id === "APIC" && !tags.cover) {
                var picEnc = data[0]
                var p = 1
                while (p < data.length && data[p] !== 0) {
                  p = p + 1
                }
                p = p + 2
                if (picEnc === 0 || picEnc === 3) {
                  while (p < data.length && data[p] !== 0) {
                    p = p + 1
                  }
                  p = p + 1
                } else {
                  while (
                    p < data.length - 1 &&
                    !(data[p] === 0 && data[p + 1] === 0)
                  ) {
                    p = p + 1
                  }
                  p = p + 2
                }
                if (p < data.length) {
                  var imgData = new Uint8Array(data.length - p)
                  for (var j = 0; j < imgData.length; j++) {
                    imgData[j] = data[p + j]
                  }
                  var mime =
                    imgData[0] === 0x89 && imgData[1] === 0x50
                      ? "image/png"
                      : "image/jpeg"
                  tags.cover = { data: imgData, mime: mime }
                }
              }
            }
            pos = pos + 10 + size
          }
          callback(tags)
        })
        reader.addEventListener("error", function () {
          callback({ title: "", artist: "", album: "", cover: null })
        })
        reader.readAsArrayBuffer(file)
      }

      var mediaFiles = []
      var srtFiles = []
      var currentMediaIndex = -1
      var subtitles = []
      var isRepeating = false
      var inactivityTimer
      var isDraggingVolume = false
      var isDragging = false
      var throttleTimeout = null
      var throttleDelay = 200

      var fileLoaderContainer = document.getElementById("fileloader-container")
      var fileSelector = document.getElementById("file-selector")
      var pleaseWait = document.querySelector(".pleasewait")
      var mediaFileInput = document.getElementById("mediafile-input")
      var mediaContainer = document.getElementById("media-container")
      var mediaPlayer = document.getElementById("mediaPlayer")
      var audioInfoContainer = document.getElementById("audio-info-container")
      var songTitle = document.getElementById("song-title")
      var artistName = document.getElementById("artist-name")
      var albumName = document.getElementById("album-name")
      var albumCover = document.getElementById("album-cover")
      var controlsBackground = document.getElementById("controls-background")
      var controlsContainer = document.getElementById("controls-container")
      var playPauseBtn = document.getElementById("play-pause-btn")
      var progressBar = document.getElementById("progress-bar")
      var timeDisplay = document.getElementById("time-display")
      var fullscreenBtn = document.getElementById("fullscreen-btn")
      var subtitlesDisplay = document.getElementById("subtitles-display")
      var volumeControls = document.getElementById("volume-controls")
      var volumeBtn = document.getElementById("volume-btn")
      var volumeSliderContainer = document.getElementById("volume-slider-container")
      var volumeSliderTrack = document.getElementById("volume-slider-track")
      var volumeSliderLevel = document.getElementById("volume-slider-level")
      var repeatMediaBtn = document.getElementById("repeat-media-btn")
      var prevMediaBtn = document.getElementById("prev-media-btn")
      var nextMediaBtn = document.getElementById("next-media-btn")

      var playIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg")
      playIcon.setAttribute("width", "24")
      playIcon.setAttribute("height", "24")
      playIcon.setAttribute("viewBox", "0 0 24 24")
      var pathPlay = document.createElementNS("http://www.w3.org/2000/svg", "path")
      pathPlay.setAttribute("d", "M8,5.14V19.14L19,12.14L8,5.14Z")
      playIcon.appendChild(pathPlay)

      var pauseIcon = document.createElementNS("http://www.w3.org/2000/svg", "svg")
      pauseIcon.setAttribute("width", "24")
      pauseIcon.setAttribute("height", "24")
      pauseIcon.setAttribute("viewBox", "0 0 24 24")
      var pathPause = document.createElementNS("http://www.w3.org/2000/svg", "path")
      pathPause.setAttribute("d", "M14,19H18V5H14M6,19H10V5H6V19Z")
      pauseIcon.appendChild(pathPause)

      var fullscreenIcon = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "svg"
      )
      fullscreenIcon.setAttribute("width", "24")
      fullscreenIcon.setAttribute("height", "24")
      fullscreenIcon.setAttribute("viewBox", "0 0 24 24")
      var pathFullscreen = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "path"
      )
      pathFullscreen.setAttribute(
        "transform",
        "translate(-2.4, -2.4),scale(1.2,1.2)"
      )
      pathFullscreen.setAttribute(
        "d",
        "M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"
      )
      fullscreenIcon.appendChild(pathFullscreen)

      var exitFullscreenIcon = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "svg"
      )
      exitFullscreenIcon.setAttribute("width", "24")
      exitFullscreenIcon.setAttribute("height", "24")
      exitFullscreenIcon.setAttribute("viewBox", "0 0 48 48")
      var pathExit1 = document.createElementNS("http://www.w3.org/2000/svg", "path")
      pathExit1.setAttribute("fill", "none")
      pathExit1.setAttribute("transform", "translate(-7,-7) scale(1.3, 1.3)")
      pathExit1.setAttribute("d", "M0 0h48v48h-48z")
      exitFullscreenIcon.appendChild(pathExit1)
      var pathExit2 = document.createElementNS("http://www.w3.org/2000/svg", "path")
      pathExit2.setAttribute("transform", "translate(-7,-7) scale(1.3, 1.3)")
      pathExit2.setAttribute(
        "d",
        "M10 32h6v6h4v-10h-10v4zm6-16h-6v4h10v-10h-4v6zm12 22h4v-6h6v-4h-10v10zm4-22v-6h-4v10h10v-4h-6z"
      )
      exitFullscreenIcon.appendChild(pathExit2)

      var volumeHighIcon = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "svg"
      )
      volumeHighIcon.setAttribute("width", "24")
      volumeHighIcon.setAttribute("height", "24")
      volumeHighIcon.setAttribute("viewBox", "0 0 24 24")
      var pathVolumeHigh = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "path"
      )
      pathVolumeHigh.setAttribute(
        "d",
        "M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z"
      )
      volumeHighIcon.appendChild(pathVolumeHigh)

      var volumeMediumIcon = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "svg"
      )
      volumeMediumIcon.setAttribute("width", "24")
      volumeMediumIcon.setAttribute("height", "24")
      volumeMediumIcon.setAttribute("viewBox", "0 0 24 24")

      var pathVolumeMedium = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "path"
      )
      pathVolumeMedium.setAttribute(
        "d",
        "M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z"
      )
      volumeMediumIcon.appendChild(pathVolumeMedium)

      var volumeLowIcon = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "svg"
      )
      volumeLowIcon.setAttribute("width", "24")
      volumeLowIcon.setAttribute("height", "24")
      volumeLowIcon.setAttribute("viewBox", "0 0 24 24")
      var pathVolumeLow = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "path"
      )
      pathVolumeLow.setAttribute("transform", "translate(-4, 0)")
      pathVolumeLow.setAttribute("d", "M7,9V15H11L16,20V4L11,9H7Z")
      volumeLowIcon.appendChild(pathVolumeLow)

      var volumeMutedIcon = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "svg"
      )
      volumeMutedIcon.setAttribute("width", "24")
      volumeMutedIcon.setAttribute("height", "24")
      volumeMutedIcon.setAttribute("viewBox", "0 0 24 24")
      var pathVolumeMuted1 = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "path"
      )
      pathVolumeMuted1.setAttribute("transform", "translate(-4, 0)")
      pathVolumeMuted1.setAttribute("d", "M7,9V15H11L16,20V4L11,9H7Z")
      volumeMutedIcon.appendChild(pathVolumeMuted1)
      var pathVolumeMuted2 = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "path"
      )
      pathVolumeMuted2.setAttribute(
        "transform",
        "translate(13, 7.25) scale(0.02, 0.02)"
      )
      pathVolumeMuted2.setAttribute(
        "d",
        "M443.6,387.1L312.4,255.4l131.5-130c5.4-5.4,5.4-14.2,0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4  L256,197.8L124.9,68.3c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4L68,105.9c-5.4,5.4-5.4,14.2,0,19.6l131.5,130L68.4,387.1  c-2.6,2.6-4.1,6.1-4.1,9.8c0,3.7,1.4,7.2,4.1,9.8l37.4,37.6c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1L256,313.1l130.7,131.1  c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1l37.4-37.6c2.6-2.6,4.1-6.1,4.1-9.8C447.7,393.2,446.2,389.7,443.6,387.1z"
      )
      volumeMutedIcon.appendChild(pathVolumeMuted2)

      function isMobileDevice() {
        return !!(
          navigator.userAgent.match(/Android/i) ||
          navigator.userAgent.match(/iPhone/i) ||
          navigator.userAgent.match(/iPad/i) ||
          navigator.userAgent.match(/iPod/i)
        )
      }

      function isUsingiOS() {
        return !!(
          navigator.userAgent.match(/iPhone/i) ||
          navigator.userAgent.match(/iPad/i) ||
          navigator.userAgent.match(/iPod/i)
        )
      }

      function getFilenameWithoutExtension(filename) {
        var lastDotIndex = filename.lastIndexOf(".")
        return lastDotIndex === -1 ? filename : filename.substring(0, lastDotIndex)
      }

      function updateNode(nodeTarget, content) {
        while (nodeTarget.firstChild) {
          nodeTarget.removeChild(nodeTarget.firstChild)
        }

        if (content instanceof Node) {
          nodeTarget.appendChild(content)
        }
      }

      function loadMedia(index) {
        if (index < 0 || index >= mediaFiles.length) {
          return
        }

        currentMediaIndex = index
        var mediaFile = mediaFiles[currentMediaIndex]
        var mediaURL = URL.createObjectURL(mediaFile)
        var fileExtension = mediaFile.name.split(".").pop().toLowerCase()

        fullscreenBtn.style.display = "flex"

        if (fileExtension === "mp3") {
          mediaPlayer.style.display = "none"
          audioInfoContainer.style.display = "flex"
          updateNode(subtitlesDisplay)

          parseID3Tags(mediaFile, function (tags) {
            songTitle.textContent = tags.title || "Unknown Title"
            artistName.textContent = tags.artist || "Unknown Artist"
            albumName.textContent = tags.album || "Unknown Album"

            if (tags.cover) {
              var base64 = ""
              for (var i = 0; i < tags.cover.data.length; i++) {
                base64 = base64 + String.fromCharCode(tags.cover.data[i])
              }
              albumCover.src = "data:" + tags.cover.mime + ";base64," + _btoa(base64)
              albumCover.style.display = "block"
            } else {
              albumCover.style.display = "none"
            }
          })
        } else {
          mediaPlayer.style.display = "block"
          audioInfoContainer.style.display = "none"
          subtitlesDisplay.style.display = "block"
        }

        document.title = getFilenameWithoutExtension(mediaFile.name)

        var mediaFilename = getFilenameWithoutExtension(mediaFile.name)
        var srtFile = srtFiles.find(function (f) {
          var srtFilename = getFilenameWithoutExtension(f.name)
          return srtFilename === mediaFilename
        })

        if (srtFile && fileExtension === "mp4") {
          loadSubtitles(srtFile)
        } else {
          subtitles = []
          updateNode(subtitlesDisplay)
          var existingTracks = mediaPlayer.querySelectorAll("track")
          for (var i = 0; i < existingTracks.length; i++) {
            existingTracks[i].remove()
          }
        }

        mediaPlayer.src = mediaURL
        mediaPlayer.load()
      }

      function playPrevMedia() {
        mediaPlayer.pause()
        timeDisplay.textContent = ""
        var prevIndex =
          (currentMediaIndex - 1 + mediaFiles.length) % mediaFiles.length
        loadMedia(prevIndex)
        prevMediaBtn.blur()
        progressBar.value = 0
      }

      function playNextMedia() {
        mediaPlayer.pause()
        timeDisplay.textContent = ""
        var nextIndex = (currentMediaIndex + 1) % mediaFiles.length
        loadMedia(nextIndex)
        nextMediaBtn.blur()
        progressBar.value = 0
      }

      function toggleRepeat() {
        isRepeating = !isRepeating
        if (isRepeating) {
          repeatMediaBtn.style.opacity = 1
        } else {
          repeatMediaBtn.style.opacity = 0.5
        }
        repeatMediaBtn.blur()
      }

      function loadSubtitles(srtFile) {
        var reader = new FileReader()
        reader.addEventListener("load", function (event) {
          var buffer = event.target.result
          var view = new Uint8Array(buffer)
          var detectedEncoding = detectEncoding(view)

          var decoder = new TextDecoder(detectedEncoding)
          var srtContent = decoder.decode(buffer)

          var existingTracks = mediaPlayer.querySelectorAll("track")
          for (var i = 0; i < existingTracks.length; i++) {
            existingTracks[i].remove()
          }

          if (isUsingiOS()) {
            var vttContent = srtToVtt(srtContent)

            var vttBlob = new Blob([vttContent], { type: "text/vtt" })
            var subtitleObjectURL = URL.createObjectURL(vttBlob)

            var track = document.createElement("track")
            track.kind = "subtitles"
            track.label = "English"
            track.srclang = "en"
            track.mode = "showing"
            track.default = true
            track.src = subtitleObjectURL
            mediaPlayer.appendChild(track)
          } else {
            subtitles = parseSRT(srtContent)
          }
        })

        reader.readAsArrayBuffer(srtFile)
      }

      function parseSRT(srtContent) {
        try {
          srtContent = srtContent.replace(/(\r?\n){3,}/g, "\r\n\r\n")

          var blocks = srtContent.trim().split(/\r?\n\r?\n/)

          var subs = blocks.map(function (block) {
            var lines = block.split(/\r?\n/)
            var id = parseInt(lines[0], 10)
            var timeParts = lines[1].split(" --> ")
            var startTimeString = timeParts[0]
            var endTimeString = timeParts[1]
            var text = lines.slice(2).join("<br>")
            var startTime = srtTimeToSeconds(startTimeString)
            var endTime = srtTimeToSeconds(endTimeString)

            return { id: id, startTime: startTime, endTime: endTime, text: text }
          })
          return subs
        } catch (err) {
          return []
        }
      }

      function srtToVtt(srtContent) {
        var vttContent = "WEBVTT\n\n"
        var srtBlocks = srtContent.split(/\r?\n\r?\n/)

        for (var i = 0; i < srtBlocks.length; i++) {
          var block = srtBlocks[i]
          var lines = block.split(/\r?\n/)

          if (lines.length < 2 || !lines[0].match(/^\d+$/)) {
            continue
          }

          var timeLine = lines[1]
          var textLines = lines.slice(2)

          timeLine = timeLine.replace(/,/g, ".").replace(/ --> /g, " --> ")

          vttContent = vttContent + timeLine + "\n"
          vttContent = vttContent + textLines.join("\n") + "\n\n"
          // note: ios has a bug that adds an extra line break in two-line subtitles,
          // and removing it makes the vtt subtitle invalid.
        }

        return vttContent
      }

      function srtTimeToSeconds(timeStr) {
        var timeParts = timeStr.split(":")
        var hours = timeParts[0]
        var minutes = timeParts[1]
        var seconds = timeParts[2]
        var secondsParts = seconds.split(",")
        var secs = secondsParts[0]
        var millis = secondsParts[1]
        return (
          parseInt(hours) * 3600 +
          parseInt(minutes) * 60 +
          parseInt(secs) +
          parseInt(millis) / 1000
        )
      }

      function detectEncoding(view) {
        // check for utf-8 bom
        if (
          view.length >= 3 &&
          view[0] === 0xef &&
          view[1] === 0xbb &&
          view[2] === 0xbf
        ) {
          return "UTF-8"
        }

        // check for utf-16 bom (little endian)
        if (view.length >= 2 && view[0] === 0xff && view[1] === 0xfe) {
          return "UTF-16LE"
        }

        // check for utf-16 bom (big endian)
        if (view.length >= 2 && view[0] === 0xfe && view[1] === 0xff) {
          return "UTF-16BE"
        }

        // heuristic check for utf-8 vs iso-8859-1
        for (var i = 0; i < view.length; i++) {
          if (view[i] < 0x80) {
            continue
          }

          if ((view[i] & 0xe0) === 0xc0) {
            if (i + 1 >= view.length || (view[i + 1] & 0xc0) !== 0x80) {
              return "ISO-8859-1"
            }
            i = i + 1
          } else if ((view[i] & 0xf0) === 0xe0) {
            if (
              i + 2 >= view.length ||
              (view[i + 1] & 0xc0) !== 0x80 ||
              (view[i + 2] & 0xc0) !== 0x80
            ) {
              return "ISO-8859-1"
            }
            i = i + 2
          } else if ((view[i] & 0xf8) === 0xf0) {
            if (
              i + 3 >= view.length ||
              (view[i + 1] & 0xc0) !== 0x80 ||
              (view[i + 2] & 0xc0) !== 0x80 ||
              (view[i + 3] & 0xc0) !== 0x80
            ) {
              return "ISO-8859-1"
            }
            i = i + 3
          } else {
            return "ISO-8859-1"
          }
        }

        return "UTF-8"
      }

      function formatTime(time) {
        var hours = Math.floor(time / 3600)
        var minutes = Math.floor((time % 3600) / 60)
        var seconds = Math.floor(time % 60)
        if (hours > 0) {
          return (
            hours.toString().padStart(2, "0") +
            ":" +
            minutes.toString().padStart(2, "0") +
            ":" +
            seconds.toString().padStart(2, "0")
          )
        }
        return (
          minutes.toString().padStart(2, "0") +
          ":" +
          seconds.toString().padStart(2, "0")
        )
      }

      function showControls() {
        controlsBackground.style.display = "block"
        controlsContainer.classList.add("visible")
        subtitlesDisplay.style.bottom = "75px"
        document.getElementsByTagName("body")[0].style.cursor = "auto"

        clearTimeout(inactivityTimer)
        inactivityTimer = setTimeout(function () {
          controlsBackground.style.display = "none"
          controlsContainer.classList.remove("visible")
          subtitlesDisplay.style.bottom = "15px"
          document.getElementsByTagName("body")[0].style.cursor = "none"
          volumeSliderContainer.classList.remove("visible")
        }, 5000)
      }

      function togglePlayPause() {
        showControls()

        if (mediaPlayer.paused) {
          mediaPlayer.play()
        } else {
          mediaPlayer.pause()
        }

        playPauseBtn.blur()
      }

      function updatePlayIcon() {
        updateNode(playPauseBtn, mediaPlayer.paused ? playIcon : pauseIcon)
      }

      function updateProgress() {
        if (!isDragging && mediaPlayer.duration) {
          progressBar.value = mediaPlayer.currentTime
          timeDisplay.textContent =
            formatTime(mediaPlayer.currentTime) +
            " / " +
            formatTime(mediaPlayer.duration)
        }
      }

      function setProgressMax() {
        progressBar.max = mediaPlayer.duration
        updateVolumeUI()
      }

      function scrub(event) {
        var scrubTime =
          (event.offsetX / progressBar.offsetWidth) * mediaPlayer.duration
        mediaPlayer.currentTime = scrubTime
      }

      function toggleFullscreen() {
        showControls()

        if (!document.fullscreenElement) {
          mediaContainer.requestFullscreen().catch(function () {})
          updateNode(fullscreenBtn, exitFullscreenIcon)
        } else {
          updateNode(fullscreenBtn, fullscreenIcon)
          document.exitFullscreen()
        }

        fullscreenBtn.blur()
      }

      function updateVolume(newVolume) {
        var clampedVolume = Math.max(0, Math.min(1, newVolume))
        mediaPlayer.volume = clampedVolume
        if (clampedVolume > 0) {
          mediaPlayer.muted = false
        }
      }

      function updateVolumeUI() {
        var volume = mediaPlayer.volume
        var isMuted = mediaPlayer.muted

        volumeSliderLevel.style.height = isMuted ? "0%" : volume * 100 + "%"

        if (isMuted || volume === 0) {
          updateNode(volumeBtn, volumeMutedIcon)
        } else if (volume < 0.33) {
          updateNode(volumeBtn, volumeLowIcon)
        } else if (volume < 0.66) {
          updateNode(volumeBtn, volumeMediumIcon)
        } else {
          updateNode(volumeBtn, volumeHighIcon)
        }
      }

      function toggleMute() {
        showControls()
        if (mediaPlayer.volume === 0) {
          mediaPlayer.volume = 1
        } else {
          mediaPlayer.muted = !mediaPlayer.muted
        }
        volumeBtn.blur()
      }

      function handleVolumeDrag(event) {
        var rect = volumeSliderTrack.getBoundingClientRect()
        var y = event.clientY - rect.top
        var percentage = Math.max(0, Math.min(1, 1 - y / rect.height))
        updateVolume(percentage)
      }

      function updateProgressOnDrag(e) {
        var rect = progressBar.getBoundingClientRect()
        var x = e.clientX - rect.left
        var percentage = Math.max(0, Math.min(1, x / rect.width))
        var scrubTime = percentage * mediaPlayer.duration
        mediaPlayer.currentTime = scrubTime
        progressBar.value = scrubTime
        timeDisplay.textContent =
          formatTime(scrubTime) + " / " + formatTime(mediaPlayer.duration)
      }

      function sortFiles(a, b) {
        var nameA = a.name.toLowerCase()
        var nameB = b.name.toLowerCase()
        var isNumericA = /^\d/.test(nameA)
        var isNumericB = /^\d/.test(nameB)

        if (isNumericA && !isNumericB) {
          return -1
        }
        if (!isNumericA && isNumericB) {
          return 1
        }
        return nameA.localeCompare(nameB, undefined, {
          numeric: true,
          sensitivity: "base",
        })
      }

      window.addEventListener("load", function () {
        if (window.top === window.self) {
          pleaseWait.style.display = "none"
          fileLoaderContainer.style.display = "block"

          mediaFileInput.value = null
          mediaFileInput.addEventListener("change", function (event) {
            pleaseWait.style.display = "block"
            fileLoaderContainer.style.display = "none"

            var files = Array.prototype.slice.call(event.target.files)

            mediaFiles = files
              .filter(function (file) {
                var extension = file.name.split(".").pop().toLowerCase()
                return extension === "mp4" || (extension === "mp3" && !isUsingiOS())
              })
              .sort(sortFiles)

            srtFiles = files
              .filter(function (file) {
                return file.name.toLowerCase().endsWith(".srt")
              })
              .sort(sortFiles)

            if (mediaFiles.length === 1) {
              repeatMediaBtn.style.display = "none"
              prevMediaBtn.style.display = "none"
              nextMediaBtn.style.display = "none"
            } else {
              repeatMediaBtn.style.display = "flex"
              prevMediaBtn.style.display = "flex"
              nextMediaBtn.style.display = "flex"
            }

            if (mediaFiles.length > 0) {
              loadMedia(0)
            } else {
              mediaFileInput.value = null
              window.location.reload()
            }
          })

          fileSelector.addEventListener("click", function () {
            mediaFileInput.click()
            fileSelector.blur()
          })

          mediaPlayer.addEventListener("timeupdate", function () {
            var currentTime = mediaPlayer.currentTime
            var currentSubtitle = subtitles.find(function (sub) {
              return currentTime >= sub.startTime && currentTime <= sub.endTime
            })

            if (currentSubtitle) {
              var subtitleElement = document.createElement("span")
              currentSubtitle.text = currentSubtitle.text.replace(/<br>/gm, "\n")
              currentSubtitle.text = currentSubtitle.text.replace(/<br \/>/gm, "\n")
              currentSubtitle.text = currentSubtitle.text.replace(/<i>/gm, "")
              currentSubtitle.text = currentSubtitle.text.replace(/<\/i>/gm, "")
              subtitleElement.innerText = currentSubtitle.text
              updateNode(subtitlesDisplay, subtitleElement)
            } else {
              updateNode(subtitlesDisplay)
            }
          })

          mediaContainer.addEventListener("mousemove", function (e) {
            if (!document.hasFocus()) {
              return
            }

            showControls()

            if (isDraggingVolume) {
              handleVolumeDrag(e)
            }
          })

          mediaPlayer.addEventListener("ended", function () {
            if (isRepeating) {
              mediaPlayer.currentTime = 0
              mediaPlayer.play()
            } else {
              playNextMedia()
            }
          })

          mediaPlayer.addEventListener("loadeddata", function () {
            pleaseWait.style.display = "none"
            mediaContainer.style.display = "block"
            mediaPlayer.play()
          })

          mediaPlayer.addEventListener("error", function (event) {
            var playerError = mediaPlayer.error || event
            if (
              playerError &&
              playerError.code === window.MediaError.MEDIA_ERR_DECODE
            ) {
              var resumeTime = mediaPlayer.currentTime
              var currentSrc = mediaPlayer.currentSrc
              mediaPlayer.src = currentSrc

              mediaPlayer.addEventListener("loadedmetadata", function handler() {
                mediaPlayer.removeEventListener("loadedmetadata", handler)
                mediaPlayer.currentTime = resumeTime
                mediaPlayer.play()
              })
            } else {
              mediaFileInput.value = null
              window.location.reload()
            }
          })

          if (isUsingiOS()) {
            mediaPlayer.setAttribute("playsinline", false)
            mediaPlayer.setAttribute("controls", true)
            subtitlesDisplay.style.display = "none"
            controlsBackground.style.display = "none"
            controlsContainer.style.display = "none"
            return
          } else {
            // thank you ios
            mediaFileInput.accept = ".mp4,.mp3,.srt"
          }

          mediaPlayer.addEventListener("play", showControls)
          mediaPlayer.addEventListener("click", togglePlayPause)
          mediaPlayer.addEventListener("play", updatePlayIcon)
          mediaPlayer.addEventListener("pause", updatePlayIcon)
          mediaPlayer.addEventListener("loadedmetadata", setProgressMax)
          mediaPlayer.addEventListener("timeupdate", updateProgress)
          mediaPlayer.addEventListener("volumechange", updateVolumeUI)
          subtitlesDisplay.addEventListener("click", togglePlayPause)
          playPauseBtn.addEventListener("click", togglePlayPause)
          fullscreenBtn.addEventListener("click", toggleFullscreen)
          updateNode(fullscreenBtn, fullscreenIcon)
          volumeBtn.addEventListener("click", toggleMute)
          repeatMediaBtn.addEventListener("click", toggleRepeat)
          prevMediaBtn.addEventListener("click", playPrevMedia)
          nextMediaBtn.addEventListener("click", playNextMedia)
          audioInfoContainer.addEventListener("click", togglePlayPause)

          if (!isMobileDevice()) {
            volumeControls.addEventListener("mouseenter", function () {
              volumeSliderContainer.classList.add("visible")
            })
            volumeControls.addEventListener("mouseleave", function () {
              if (!isDraggingVolume) {
                volumeSliderContainer.classList.remove("visible")
              }
            })
            volumeSliderTrack.addEventListener("mousedown", function (e) {
              isDraggingVolume = true
              handleVolumeDrag(e)
            })
          }

          if (isMobileDevice()) {
            progressBar.addEventListener("click", scrub)
          } else {
            progressBar.addEventListener("mousedown", function (e) {
              isDragging = true
              mediaPlayer.pause()
              updateProgressOnDrag(e)
            })

            document.addEventListener("mousemove", function (e) {
              if (isDragging) {
                updateProgressOnDrag(e)
              }
            })
          }

          document.addEventListener("mouseup", function () {
            if (isDragging) {
              isDragging = false
              mediaPlayer.play()
            }

            if (isDraggingVolume) {
              isDraggingVolume = false

              if (!volumeControls.matches(":hover")) {
                volumeSliderContainer.classList.remove("visible")
              }
            }
          })

          document.addEventListener("keyup", function (event) {
            if (!mediaPlayer.src) {
              return
            }

            if (event.code === "KeyF") {
              fullscreenBtn.click()
            } else if (event.code === "Space") {
              playPauseBtn.click()
            }
          })

          document.addEventListener("keydown", function (event) {
            if (!mediaPlayer.src) {
              return
            }

            if (throttleTimeout) {
              return
            }

            if (event.code === "ArrowLeft") {
              showControls()
              mediaPlayer.currentTime = mediaPlayer.currentTime - 10
              throttleTimeout = setTimeout(function () {
                throttleTimeout = null
              }, throttleDelay)
            } else if (event.code === "ArrowRight") {
              showControls()
              mediaPlayer.currentTime = mediaPlayer.currentTime + 10
              throttleTimeout = setTimeout(function () {
                throttleTimeout = null
              }, throttleDelay)
            }
          })
        }
      })
    </script>
  </body>
</html>
